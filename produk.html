<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/images/favicon/favicon.ico" type="image/x-icon">
    <title>product</title>
    <meta name="description" content="KopiKuy menghadirkan kopi berkualitas premium untuk penggemar kopi sejati">
    <meta name="keywords" content="Kopi premium, biji kopi pilihan, kopi terbaik">
    <meta name="author" content="John Doe">
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/bootstrap-icons.css">
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #F0F3F7;
        }

        .card {
            border: none;
            box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .075);
        }

        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        .form-floating label {
            margin-left: 10px;
        }

        .modal-shadow {
            box-shadow: rgba(141, 150, 170, 0.4) 0px 1px 4px;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <!-- Tulis Kode Bootstrap Di Bawah Sini -->

    <nav class="navbar navbar-expand-lg bg-success navbar-dark w-100 fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <h1>
                    <a href="index.html">
                        <img class="logo" src="assets/images/logo/logo_kuy.png" alt="logo kopikuy" title="kopikuy"
                            height="40">
                    </a>
                </h1>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto me-3 mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#best-seller">Best Seller</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#our-team">Our Team</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#review">Review</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#contact-us">Contact Us</a>
                    </li>
                </ul>
                <a href="cart.html" class="btn btn-outline-light position-relative me-md-3">
                    <i class="bi bi-cart4"></i>
                    <span id="cartIcon"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                </a>
                <a href="#" class="btn btn-outline-light position-relative me-md-3">
                    <i class="bi bi-heart" id="wishlistIcon"></i>
                    <span id="wishlistCount"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                </a>
                <a class="btn btn-outline-light" href="https://wa.me/628123456?text=Saya ingin bertanya"
                    target="_blank">Chat <i class="bi bi-whatsapp"></i></a>
            </div>
        </div>
    </nav>

    <section class="product text-center my-5 py-5">
        <div class="container">
            <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="assets/images/carousel/slider1.jpg" class="d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="assets/images/carousel/slider2.jpg" class="d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="assets/images/carousel/slider3.jpg" class="d-block w-100" alt="...">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
            <div class="row gap-2 gap-md-0 my-5">
                <div class="col-md-6">
                    <div class="input-group mb-3 h-100">
                        <button class="btn btn-outline-secondary border px-3" type="button" id="searchButton"><i
                                class="bi bi-search"></i></button>
                        <input type="text" class="form-control border-start-0 border" placeholder="Cari di Kopikuy"
                            id="searchInput">
                        <button class="btn btn-outline-secondary bg-white border-start-0 border" type="button"
                            id="clearSearch"><i class="bi bi-x text-dark"></i></button>
                    </div>
                </div>
                <div class="form-floating col-md-3">
                    <select class="form-select" id="selectCategory">
                        <option selected value="viewAll">All category</option>
                        <option value="arabica">Arabica</option>
                        <option value="robusta">Robusta</option>
                        <option value="nonkopi">nonkopi</option>
                        <option value="makanberat">Makanan</option>
                    </select>
                    <label for="selectCategory">Choose a category</label>
                </div>
                <div class="form-floating col-md-3">
                    <select class="form-select" id="sortPrice">
                        <option selected disabled value="default">Default</option>
                        <option value="cheap">Cheapest</option>
                        <option value="expensive">Expensive</option>
                    </select>
                    <label for="sortPrice">Sort by</label>
                </div>
            </div>
            <div id="keywordNotFound" class="alert alert-danger mt-3 d-none">
                <i class="bi bi-exclamation-triangle-fill"></i> Sorry, the product you looking for is not available here
            </div>
            <div id="productPage" class="row row-cols-1 row-cols-md-2 row-cols-lg-4">
            </div>
        </div>
    </section>

    <footer class="bg-success footer py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link link-light active" aria-current="page" href="index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link link-light" href="index.html#best-seller">Best Seller</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link link-light" href="index.html#our-team">Our Team</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link link-light" href="index.html#review">Review</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link link-light" href="index.html#contact-us">Contact Us</a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4 text-light text-end">
                    Copyright Kopi Kuy 2024
                </div>
            </div>
        </div>
    </footer>

    <div class="modal fade" id="addToCartConfirmation" aria-labelledby="addToCartLabel">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title fw-normal fs-5" id="addToCartLabel"><i class="bi bi-cart-check"></i>
                        Product successfully added to cart</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="addedCard">
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="cart.html" class="btn btn-success">View Cart</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Batas Akhir penulisan kode Bootstrap -->
    <script>
        /* Tulis Javascript Di bawah Sini */

        const webApi = "https://rikikurnia.com/prakerja/api/kopi"
        const localApi = "data.json"
        let cart = [];
        let wishlist = [];
        let selectedCategory = []

        const shuffleArray = (arr) => {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        };

        function getProductData(category) {

            if (category === "viewAll") {
                Promise.all([
                    fetch(webApi).then(response => response.json()),
                    fetch(localApi).then(response => response.json())
                ]).then(([datawebApi, datalocalApi]) => {
                    console.log("datawebApi: ", datawebApi);
                    console.log("datalocalApi: ", datalocalApi);
                    selectedCategory = [
                        ...datawebApi.robusta,
                        ...datawebApi.arabica,
                        ...datawebApi.nonkopi,
                        ...datalocalApi.makanberat,
                    ];
                    shuffleArray(selectedCategory);
                    showProducts(selectedCategory);
                }).catch(error => console.error("Error fetching api: ", error));
            } else if (category === "makanberat") {
                fetch(localApi)
                    .then(response => response.json())
                    .then(data => {
                        console.log("fetched data: ", data);
                        selectedCategory = data.makanberat;
                        showProducts(selectedCategory);
                    }).catch(error => console.error("Error fetching api: ", error));
            } else {
                fetch(webApi)
                    .then(response => response.json())
                    .then(data => {
                        selectedCategory = data[category];
                        showProducts(selectedCategory);
                    }).catch(error => console.error('Error fetching api', error));
            }
        }


        function showProducts(selectedCategory) {
            productPage.innerHTML = ""

            selectedCategory.forEach(product => {
                productPage.innerHTML += `<div class="col mb-4 d-flex align-items-stretch">
                                            <div class="card">
                                                <img src="${product.foto}" class="card-img-top" alt="menu ${product.nama}">
                                                <div class="card-body d-flex flex-column">
                                                    <h5 class="card-title">${product.nama}</h5>
                                                    <div class="row my-4">
                                                        <div class="col">
                                                            ${product.size}
                                                        </div>
                                                        <div class="col">
                                                            ${product.harga}
                                                        </div>
                                                    </div>
                                                    <div class="d-flex mt-auto align-items-center">
                                                        <button onclick='addToCartModal(${JSON.stringify({
                    nama: product.nama,
                    harga: product.harga,
                    foto: product.foto,
                    hargaint: product.harga.replace(".", "") * 1,
                    qty: 1,
                })})' class="btn btn-success flex-grow-1 me-md-3 title=" Add to cart">
                                                            <i class="bi bi-cart4"></i> Add
                                                        </button>
                                                        <button onclick='toggleWishlist(this, ${JSON.stringify({
                    nama: product.nama,
                    harga: product.harga,
                    foto: product.foto,
                    hargaint: product.harga.split(".").join("") * 1,
                })})' class="btn btn-outline-danger" title="Add to wishlist">
                                                            <i class="bi bi-heart"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>`;
            });
        }


        document.addEventListener("DOMContentLoaded", () => {

            const sortPrice = document.getElementById("sortPrice");
            const searchForm = document.getElementById("searchInput");
            const selectCategory = document.getElementById("selectCategory");
            const keywordNotFound = document.getElementById("keywordNotFound")

            getProductData("viewAll");

            selectCategory.addEventListener("change", (event) => {
                // cannot using 'this' inside arrow function
                // using targetr to get the element
                const category = event.target.value;
                console.log(category);
                getProductData(category);
                sortPrice.value = "default";
            });

            sortPrice.addEventListener("change", (event) => {
                const sortType = event.currentTarget.value;
                const keyword = searchForm.value.toLowerCase();
                const filteredData = selectedCategory.filter((product) => {
                    return product.nama.toLowerCase().includes(keyword);
                });


                sortProducts(filteredData, sortType)
            });

            searchForm.addEventListener("keydown", (event) => event.key === "Enter" ? searchResult() : undefined);
            document.getElementById("searchButton").addEventListener("click", searchResult);
            document.getElementById("clearSearch").addEventListener("click", clearSearchResult);

            function sortProducts(data, sortType) {
                if (sortType === "cheap") {
                    data.sort((a, b) => a.harga - b.harga);
                } else {
                    data.sort((a, b) => b.harga - a.harga);
                }
                checkProductLength(data);
            }

            function searchResult() {

                sortPrice.value = "default";
                const keyword = searchForm.value.toLowerCase();
                const filteredData = selectedCategory.filter((product) => product.nama.toLowerCase().includes(keyword));

                keywordNotFound.classList.toggle("d-none", filteredData.length > 0)
                checkProductLength(filteredData);
            }

            function checkProductLength(data) {
                const productPage = document.getElementById("productPage");
                data.length < 1 ? productPage.innerHTML = "" : showProducts(data);
            }

            function clearSearchResult() {
                searchForm.value = "";
                keywordNotFound.classList.add("d-none");
                getProductData(selectCategory.value);
            }

        });

        function addToCart(item) {
            cart.push(item);
            updateLocalStorage("cart", cart);
            updateIcon("cartIcon", "cart", (iconDataLen) => iconDataLen === 0);
        }

        const updateLocalStorage = (name, key) => localStorage.setItem(name, JSON.stringify(key));


        function updateIcon(iconElementId, data, toggleIcon) {
            const iconElement = document.getElementById(iconElementId);
            const iconData = Array.isArray(data) ? data.length : JSON.parse(localStorage.getItem(data) ?? "[]").length;

            iconElement.textContent = iconData;
            iconElement.classList.toggle("d-none", toggleIcon(iconData));
        }

        updateIcon("cartIcon", "cart", (iconDataLen) => iconDataLen === 0);
        updateIcon("wishlistCount", wishlist, (iconDataLen) => iconDataLen === 0);


        function toggleWishlist(button, item) {
            const index = wishlist.findIndex((wishlistItem) => wishlistItem.nama === item.nama);

            if (index === -1) {
                wishlist.push(item);
                button.innerHTML = '<i class="bi bi-heart-fill"></i>';
                button.classList.add('text-danger');
            } else {
                wishlist.splice(index, 1);
                button.innerHTML = '<i class="bi bi-heart"></i>';
                button.classList.remove('text-danger');
            }

            updateIcon("wishlistCount", wishlist, (iconDataLen) => iconDataLen === 0);
        }


        const addToCartModal = (product) => {
            addToCart(product);
            showModal(product);
            const modal = new bootstrap.Modal(document.getElementById('addToCartConfirmation'));
            modal.show();
        }

        const showModal = (product) => {

            const modalContent = document.getElementById("addedCard");
            modalContent.innerHTML = "";

            // created using createElement() other than innerHTML template literal. Learning purposes

            // create outer div class row
            const parentDiv = document.createElement("div");
            parentDiv.classList.add("row", "modal-shadow", "m-2");

            // create div class col-md-3
            const div = document.createElement("div");
            div.classList.add("col-md-3", "p-2", "d-flex", "align-items-center", "justify-content-center");

            // create image element
            const image = document.createElement("img");
            image.setAttribute("src", product.foto);
            image.setAttribute("height", "90");
            image.setAttribute("width", "90");
            image.setAttribute("alt", "menu " + product.nama)
            image.classList.add("img-fluid", "rounded");

            // create another div class col-md-9
            const div2 = document.createElement("div");
            div2.classList.add("col-md-9", "d-flex", "align-items-center");

            // create heading element
            const heading5 = document.createElement("h5");
            heading5.classList.add("text-md-start", "text-center");
            heading5.textContent = product.nama;

            // push image into div class col-md-3
            div.appendChild(image)
            // push heading h5 into div class col-md-9
            div2.appendChild(heading5)
            // push div class col-md-3 into outer div class row
            parentDiv.appendChild(div)
            // push div class col-md-9 into outer div class row
            parentDiv.appendChild(div2)
            // push complete row into modalContent page
            modalContent.appendChild(parentDiv)

        }

        /* Batas Akhir penulisan kode Javascript */
    </script>
</body>

</html>